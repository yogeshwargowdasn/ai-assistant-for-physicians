<!-- templates/symptom_suggest.html -->
{% extends "base.html" %}
{% block title %}Symptom Suggestion{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">ðŸ’¡ AI Symptom Suggestion</h2>
  <a href="{{ url_for('auth.dashboard') }}" class="btn btn-secondary mb-3">Back to Dashboard</a>

  <div class="mb-3">
    <label for="symptomInput" class="form-label">Enter Known Symptom(s)</label>
    <input type="text" class="form-control" id="symptomInput" placeholder="e.g., fever, cough">
  </div>
  <button class="btn btn-primary" onclick="fetchSuggestions()">Suggest Related Symptoms</button>

  <div class="mt-4">
    <h4>âœ… AI Suggested Symptoms:</h4>
    <div id="suggestions" class="mb-3"></div>
    <button class="btn btn-success" onclick="saveSelected()">Save Selected</button>
  </div>

  <form id="finalForm" action="/submit-symptoms" method="POST">
    <input type="hidden" id="finalSymptoms" name="finalSymptoms">
    <div class="mt-3">
      <h5>ðŸ“‹ Final Selected Symptoms:</h5>
      <ul id="selectedList" class="list-group mb-3"></ul>
      <button class="btn btn-dark" type="submit">Submit Symptoms</button>
    </div>
  </form>
</div>

<script>
async function fetchSuggestions() {
  const input = document.getElementById('symptomInput').value;
  if (!input) return;

  const res = await fetch('/ai/symptom-suggest', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ input_text: input })
  });

  const data = await res.json();
  const container = document.getElementById('suggestions');
  container.innerHTML = '';

  if (data.related_symptoms) {
    data.related_symptoms.forEach(symptom => {
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.value = symptom;
      checkbox.id = symptom;

      const label = document.createElement('label');
      label.htmlFor = symptom;
      label.innerText = ' ' + symptom;

      const div = document.createElement('div');
      div.className = "form-check";
      div.appendChild(checkbox);
      div.appendChild(label);

      container.appendChild(div);
    });
  } else {
    container.innerHTML = "<p class='text-danger'>No suggestions found.</p>";
  }
}

function saveSelected() {
  const checkboxes = document.querySelectorAll('#suggestions input[type="checkbox"]:checked');
  const list = document.getElementById('selectedList');
  const hiddenInput = document.getElementById('finalSymptoms');
  list.innerHTML = '';

  const selected = [];
  checkboxes.forEach(cb => {
    selected.push(cb.value);
    const li = document.createElement('li');
    li.className = "list-group-item";
    li.innerText = cb.value;
    list.appendChild(li);
  });

  hiddenInput.value = selected.join(','); // send to backend
}
</script>
{% endblock %}
