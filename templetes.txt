1. hospital_management/templates/base.html:
	<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Hospital Management System{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
        }

        .sidebar {
            width: 250px;
            min-height: 100vh;
        }

        .sidebar .nav-link {
            padding: 10px 15px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .sidebar .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar h4 {
            font-weight: bold;
        }

        .nav-link i {
            font-size: 1rem;
        }

        .collapse .nav-link {
            font-size: 0.95rem;
            padding-left: 30px;
        }

        .main-content {
            background-color: #f8f9fa;
            min-height: 100vh;
        }
    </style>
</head>
<body>
<div class="d-flex">
    <!-- Sidebar -->
    <div class="bg-dark text-white p-3 sidebar">
        <h4 class="mb-4"><i class="bi bi-hospital-fill text-danger"></i> Hospital AI</h4>

        {% if current_user.is_authenticated %}
            <p class="text-white-50 small">Logged in as: {{ current_user.role }}</p> <!-- DEBUG LINE -->

            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link text-white" href="{{ url_for('auth.dashboard') }}">
                        <i class="bi bi-speedometer2 me-2"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="{{ url_for('appointment.create_appointment') }}">
                        <i class="bi bi-calendar-plus me-2"></i> Create Appointment
                    </a>
                </li>
                {% if current_user.role in ['admin', 'doctor'] %}
                    <li class="nav-item">
                        <a class="nav-link text-white" href="{{ url_for('appointment.view_appointments') }}">
                            <i class="bi bi-calendar-check me-2"></i> View Appointments
                        </a>
                    </li>
                {% endif %}
                <li class="nav-item">
                    <a class="nav-link text-white" href="{{ url_for('report.upload_report') }}">
                        <i class="bi bi-upload me-2"></i> Upload Report
                    </a>
                </li>

                <!-- AI Tools Section -->
                <li class="nav-item">
                    <a class="nav-link text-white" data-bs-toggle="collapse" href="#aiTools" role="button" aria-expanded="false">
                        <i class="bi bi-cpu me-2"></i> AI Tools <i class="bi bi-chevron-down float-end"></i>
                    </a>
                    <div class="collapse" id="aiTools">
                        <ul class="nav flex-column ms-3 mt-1">
                            <li class="nav-item">
                                <a class="nav-link text-white" href="{{ url_for('main.symptom_suggest_page') }}">
                                    <i class="bi bi-lightbulb me-2"></i> Symptom Suggest
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="{{ url_for('main.speech_to_text_page') }}">
                                    <i class="bi bi-mic me-2"></i> Speech to Text
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link text-white" href="{{ url_for('main.predict_disease_page') }}">
                                    <i class="bi bi-heart-pulse me-2"></i> Disease Prediction
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>

                <!-- Logout -->
                <li class="nav-item mt-4">
                    <a class="nav-link text-warning" href="{{ url_for('auth.logout') }}">
                        <i class="bi bi-box-arrow-right me-2"></i> Logout
                    </a>
                </li>
            </ul>
        {% else %}
            <p class="text-white">Not logged in</p>
        {% endif %}
    </div>

    <!-- Main Content -->
    <div class="flex-grow-1 p-4 main-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} shadow-sm">{{ message }}</div>
            {% endfor %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>
</div>
</body>
</html>

2. hospital_management/templates/symptom_suggest.html:
<!-- templates/symptom_suggest.html -->
{% extends "base.html" %}
{% block title %}Symptom Suggestion{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">💡 AI Symptom Suggestion</h2>
  <a href="{{ url_for('auth.dashboard') }}" class="btn btn-secondary mb-3">Back to Dashboard</a>

  <div class="mb-3">
    <label for="symptomInput" class="form-label">Enter Known Symptom(s)</label>
    <input type="text" class="form-control" id="symptomInput" placeholder="e.g., fever, cough">
  </div>
  <button class="btn btn-primary" onclick="fetchSuggestions()">Suggest Related Symptoms</button>

  <div class="mt-4">
    <h4>✅ AI Suggested Symptoms:</h4>
    <div id="suggestions" class="mb-3"></div>
    <button class="btn btn-success" onclick="saveSelected()">Save Selected</button>
  </div>

  <form id="finalForm" action="/submit-symptoms" method="POST">
    <input type="hidden" id="finalSymptoms" name="finalSymptoms">
    <div class="mt-3">
      <h5>📋 Final Selected Symptoms:</h5>
      <ul id="selectedList" class="list-group mb-3"></ul>
      <button class="btn btn-dark" type="submit">Submit Symptoms</button>
    </div>
  </form>
</div>

<script>
async function fetchSuggestions() {
  const input = document.getElementById('symptomInput').value;
  if (!input) return;

  const res = await fetch('/ai/symptom-suggest', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ input_text: input })
  });

  const data = await res.json();
  const container = document.getElementById('suggestions');
  container.innerHTML = '';

  if (data.related_symptoms) {
    data.related_symptoms.forEach(symptom => {
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.value = symptom;
      checkbox.id = symptom;

      const label = document.createElement('label');
      label.htmlFor = symptom;
      label.innerText = ' ' + symptom;

      const div = document.createElement('div');
      div.className = "form-check";
      div.appendChild(checkbox);
      div.appendChild(label);

      container.appendChild(div);
    });
  } else {
    container.innerHTML = "<p class='text-danger'>No suggestions found.</p>";
  }
}

function saveSelected() {
  const checkboxes = document.querySelectorAll('#suggestions input[type="checkbox"]:checked');
  const list = document.getElementById('selectedList');
  const hiddenInput = document.getElementById('finalSymptoms');
  list.innerHTML = '';

  const selected = [];
  checkboxes.forEach(cb => {
    selected.push(cb.value);
    const li = document.createElement('li');
    li.className = "list-group-item";
    li.innerText = cb.value;
    list.appendChild(li);
  });

  hiddenInput.value = selected.join(','); // send to backend
}
</script>
{% endblock %}

4. hospital_management/templates/symptom_predict.html:	
<!-- templates/symptom_predict.html -->
{% extends "base.html" %}
{% block title %}Disease & Lab Test Prediction{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2>Disease & Lab Test Prediction</h2>
  <a href="{{ url_for('auth.dashboard') }}" class="btn btn-secondary mb-3">Back to Dashboard</a>


  <form id="predictForm" onsubmit="return false;">
    <label for="symptoms">Select Symptoms:</label><br>
    <div id="symptomCheckboxes" class="mb-3 row">
      {% for symptom in symptoms %}
      <div class="form-check col-md-3">
        <input class="form-check-input" type="checkbox" name="symptoms" value="{{ symptom }}" id="symptom_{{ loop.index }}">
        <label class="form-check-label" for="symptom_{{ loop.index }}">{{ symptom|capitalize }}</label>
      </div>
      {% endfor %}
    </div>
    <button type="submit" class="btn btn-success" onclick="predictDisease()">Predict</button>
  </form>

  <div class="mt-4" id="result" style="display: none;">
    <h4>Predicted Disease:</h4>
    <p id="predictedDisease" class="text-primary fw-bold"></p>

    <h4>Recommended Lab Tests:</h4>
    <ul id="recommendedTests" class="list-group"></ul>
  </div>
</div>

<script>
async function predictDisease() {
  const checkboxes = document.querySelectorAll('input[name="symptoms"]:checked');
  if (checkboxes.length === 0) {
    alert("Please select at least one symptom.");
    return;
  }
  const selectedSymptoms = Array.from(checkboxes).map(cb => cb.value);

  try {
    const res = await fetch("/ai/predict-disease", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ symptoms: selectedSymptoms })
    });

    if (!res.ok) throw new Error("Network response was not ok");

    const data = await res.json();

    document.getElementById("result").style.display = "block";
    document.getElementById("predictedDisease").innerText = data.disease || "No disease predicted.";

    const testsList = document.getElementById("recommendedTests");
    testsList.innerHTML = "";
    if (data.tests && data.tests.length > 0) {
      data.tests.forEach(test => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.innerText = test;
        testsList.appendChild(li);
      });
    } else {
      const li = document.createElement("li");
      li.className = "list-group-item text-danger";
      li.innerText = "No tests recommended.";
      testsList.appendChild(li);
    }
  } catch (err) {
    alert("Error predicting disease: " + err.message);
  }
}
</script>
{% endblock %}

3. hospital_management/templates/speech_to_text.html:
{% extends "base.html" %}
{% block title %}Speech to Text{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Speech to Symptom</title>
  <a href="{{ url_for('auth.dashboard') }}" class="btn btn-secondary mb-3">Back to Dashboard</a>

  <script>
    let mediaRecorder;
    let audioChunks = [];

    async function startRecording() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

      mediaRecorder.onstop = async () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
        audioChunks = [];

        const formData = new FormData();
        formData.append('audio', audioBlob, 'recording.wav');

        const response = await fetch('/ai/speech-to-text', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        document.getElementById('result').innerText = 
          "🗣️ Transcript: " + result.transcript + 
          "\n🩺 Symptoms: " + result.detected_symptoms.join(', ');
      };

      mediaRecorder.start();
      setTimeout(() => mediaRecorder.stop(), 5000); // 5 sec recording
    }
  </script>
</head>
<body>
  <h2>🎙️ Speech to Symptom</h2>
  <button onclick="startRecording()">Start Recording</button>
  <p id="result" style="white-space: pre-line; font-weight: bold;"></p>
</body>
</html>
{% endblock %}